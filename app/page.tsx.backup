'use client';

export default function Home() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-blue-50 px-4 py-12">
      <div className="max-w-3xl w-full">
        <div className="bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden">
          {/* Header */}
          <div className="bg-gradient-to-r from-blue-600 to-blue-700 px-8 py-6">
            <div className="flex items-center justify-center gap-3 mb-2">
              <svg className="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <h1 className="text-3xl font-bold text-white">Dorixona</h1>
            </div>
            <p className="text-blue-100 text-center text-sm">Xizmat vaqtincha to'xtatildi ‚Ä¢ –°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</p>
          </div>

          {/* Content */}
          <div className="px-8 py-10 space-y-10">
            {/* Uzbek Section */}
            <div className="space-y-4">
              <h2 className="text-2xl font-bold text-gray-900 flex items-center gap-2">
                <span className="text-blue-600">üá∫üáø</span>
                Yangilanish haqida
              </h2>
              <p className="text-gray-700 leading-relaxed text-lg">
                Elektron retsept tizimi bo'yicha yangi tartiblar joriy etilayotgani sababli Dorixona xizmati vaqtincha to'xtatildi. Xizmat yangilangan talablar asosida qayta ishga tushiriladi.
              </p>
              <a 
                href="https://telegra.ph/EHlektron-recept-tizimini-zhorij-ehtish-masalalari-mu%D2%B3okama-%D2%9Bilindi-12-14"
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium transition-colors group"
              >
                <span>Batafsil ma'lumot</span>
                <svg className="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7l5 5m0 0l-5 5m5-5H6" />
                </svg>
              </a>
            </div>

            {/* Divider */}
            <div className="border-t border-gray-200"></div>

            {/* Russian Section */}
            <div className="space-y-4">
              <h2 className="text-2xl font-bold text-gray-900 flex items-center gap-2">
                <span className="text-blue-600">üá∑üá∫</span>
                –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
              </h2>
              <p className="text-gray-700 leading-relaxed text-lg">
                –í —Å–≤—è–∑–∏ —Å –≤–≤–µ–¥–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª –ø–æ —Å–∏—Å—Ç–µ–º–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ —Å–µ—Ä–≤–∏—Å Dorixona –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –†–∞–±–æ—Ç–∞ –±—É–¥–µ—Ç –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ—Å–ª–µ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –∫ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.
              </p>
              <a 
                href="https://telegra.ph/Obsuzhdeny-voprosy-vnedreniya-sistemy-EHlektronnyj-recept-12-14"
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium transition-colors group"
              >
                <span>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</span>
                <svg className="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7l5 5m0 0l-5 5m5-5H6" />
                </svg>
              </a>
            </div>
          </div>

          {/* Footer */}
          <div className="bg-gray-50 px-8 py-6 border-t border-gray-100">
            <p className="text-center text-sm text-gray-500">
              Iltimos, keyinroq qayta urinib ko'ring ‚Ä¢ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

/*
// ORIGINAL CODE - COMMENTED OUT FOR MAINTENANCE MODE
// TO RE-ENABLE: Uncomment everything below and remove the maintenance component above

'use client';

import { useState, useEffect, useMemo } from 'react';
import Fuse from 'fuse.js';
import Link from 'next/link';
import { useLanguage } from './context/LanguageContext';

interface Medicine {
  id: string;
  brandName?: string;
  activeIngredient?: string;
  manufacturer?: string;
  packaging?: string;
  registrationNumber: string;
  currency?: string;
  basePrice?: string;
  wholesalePrice?: string;
  retailPrice?: string;
  dispensingCondition: string;
  // Fields from no-prescription list
  dosageForm?: string;
  pharmacotherapyGroup?: string;
  prescriptionRequired?: boolean;
}

export default function HomeOriginal() {
  const { language, setLanguage, t } = useLanguage();
  const [medicines, setMedicines] = useState<Medicine[]>([]);
  const [searchQuery, setSearchQuery] = useState('');
  const [debouncedQuery, setDebouncedQuery] = useState('');
  const [prescriptionFilter, setPrescriptionFilter] = useState<'all' | 'with' | 'without'>('without');
  const [loading, setLoading] = useState(true);
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 10;

  useEffect(() => {
    // Load both medicine lists
    Promise.all([
      fetch('/medicines.json').then(res => res.json()),
      fetch('/medicines-no-prescription.json').then(res => res.json())
    ])
      .then(([prescriptionMeds, noPrescriptionMeds]) => {
        // Combine both lists
        const combined = [...prescriptionMeds, ...noPrescriptionMeds];
        setMedicines(combined);
        setLoading(false);
      })
      .catch((error) => {
        console.error('Dorilarni yuklashda xatolik:', error);
        setLoading(false);
      });
  }, []);

  // Debounce search query
  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedQuery(searchQuery);
      setCurrentPage(1); // Reset to first page on search
      // When search is made, switch to 'all' filter
      if (searchQuery.trim()) {
        setPrescriptionFilter('all');
      }
    }, 300);
    return () => clearTimeout(timer);
  }, [searchQuery]);

  // Transliteration map: Latin to Cyrillic (optimized)
  const latinToCyrillic = useMemo(() => {
    const map: { [key: string]: string } = {
      'shch': '—â', 'Shch': '–©', 'ch': '—á', 'Ch': '–ß', 'sh': '—à', 'Sh': '–®',
      'yo': '—ë', 'Yo': '–Å', 'yu': '—é', 'Yu': '–Æ', 'ya': '—è', 'Ya': '–Ø',
      'ye': '–µ', 'Ye': '–ï', 'ts': '—Ü', 'Ts': '–¶',
      'a': '–∞', 'b': '–±', 'v': '–≤', 'g': '–≥', 'd': '–¥', 'e': '–µ', 'j': '–∂',
      'z': '–∑', 'i': '–∏', 'y': '–π', 'k': '–∫', 'l': '–ª', 'm': '–º', 'n': '–Ω', 'o': '–æ',
      'p': '–ø', 'r': '—Ä', 's': '—Å', 't': '—Ç', 'u': '—É', 'f': '—Ñ', 'x': '—Ö',
      'A': '–ê', 'B': '–ë', 'V': '–í', 'G': '–ì', 'D': '–î', 'E': '–ï', 'J': '–ñ',
      'Z': '–ó', 'I': '–ò', 'Y': '–ô', 'K': '–ö', 'L': '–õ', 'M': '–ú', 'N': '–ù', 'O': '–û',
      'P': '–ü', 'R': '–†', 'S': '–°', 'T': '–¢', 'U': '–£', 'F': '–§', 'X': '–•'
    };
    
    return (text: string): string => {
      let result = text;
      const patterns = Object.keys(map).sort((a, b) => b.length - a.length);
      for (const pattern of patterns) {
        result = result.replace(new RegExp(pattern, 'g'), map[pattern]);
      }
      return result;
    };
  }, []);

  const fuse = useMemo(
    () =>
      new Fuse(medicines, {
        keys: [
          'brandName', 
          'activeIngredient', 
          'manufacturer',
          'dosageForm',
          'pharmacotherapyGroup'
        ],
        threshold: 0.3,
        includeScore: true,
      }),
    [medicines]
  );

  const filteredMedicines = useMemo(() => {
    let results = medicines;
    
    // Apply search filter
    if (debouncedQuery.trim()) {
      const transliteratedQuery = latinToCyrillic(debouncedQuery);
      const searchTerm = transliteratedQuery !== debouncedQuery ? transliteratedQuery : debouncedQuery;
      results = fuse.search(searchTerm).map((result) => result.item);
    }
    
    // Apply prescription filter
    if (prescriptionFilter !== 'all') {
      results = results.filter((medicine) => {
        const requiresPrescription = medicine.dispensingCondition === '–ü–æ —Ä–µ—Ü–µ–ø—Ç—É' || medicine.prescriptionRequired === true;
        return prescriptionFilter === 'with' ? requiresPrescription : !requiresPrescription;
      });
    }
    
    return results;
  }, [debouncedQuery, prescriptionFilter, medicines, fuse, latinToCyrillic]);

  const totalPages = Math.ceil(filteredMedicines.length / itemsPerPage);
  const paginatedMedicines = useMemo(() => {
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    return filteredMedicines.slice(startIndex, endIndex);
  }, [filteredMedicines, currentPage, itemsPerPage]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-stone-100">
      {/* Header */}
      <header className="bg-white shadow-md border-b-2 border-green-200">
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex-1">
              <h1 className="text-2xl md:text-3xl font-bold text-gray-600">
                {t('header.search')}
              </h1>
              <p className="text-sm text-black mt-1">
                {medicines.length.toLocaleString()} {t('header.medicines_available')}
              </p>
            </div>
            <div className="flex items-center gap-4 justify-end">
              {/* Language Switcher */}
              <div className="flex gap-1 bg-gray-100 rounded-lg p-1">
                <button
                  onClick={() => setLanguage('uz')}
                  className={`px-2 py-1 text-xs font-semibold rounded transition-colors ${
                    language === 'uz'
                      ? 'bg-white text-gray-800 shadow-sm'
                      : 'text-gray-600 hover:text-gray-800'
                  }`}
                >
                  UZ
                </button>
                <button
                  onClick={() => setLanguage('ru')}
                  className={`px-2 py-1 text-xs font-semibold rounded transition-colors ${
                    language === 'ru'
                      ? 'bg-white text-gray-800 shadow-sm'
                      : 'text-gray-600 hover:text-gray-800'
                  }`}
                >
                  RU
                </button>
              </div>
              <div className="flex gap-3 items-center">
                <Link 
                  href="/"
                  className="text-sm font-semibold text-green-600"
                >
                  {t('header.search')}
                </Link>
                <Link 
                  href="/sources"
                  className="text-sm font-semibold text-gray-700 hover:text-green-600 transition-colors"
                >
                  {t('header.sources')}
                </Link>
              </div>
            </div>
          </div>
        </div>
      </header>

      {/* Last Updated Tag */}
      <div className="bg-gray-50 border-b border-gray-200 py-2">
        <div className="container mx-auto px-4">
          <div className="flex justify-center">
            <span className="px-1.5 py-0.5 text-[10px] font-semibold bg-green-100 text-green-700 rounded-full border border-green-300 shadow-sm">
              {t('header.last_updated')}
            </span>
          </div>
        </div>
      </div>

      {/* Search Section */}
      <main className="container mx-auto px-4 py-6 md:py-8">
        <div className="max-w-2xl mx-auto mb-6">
          <div className="relative">
            <input
              type="text"
              placeholder={t('search.placeholder')}
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full px-4 py-3 md:py-4 pl-12 text-base md:text-lg rounded-xl border-2 border-gray-300 focus:outline-none focus:ring-2 bg-white text-black"
            />
            <svg
              className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
          </div>
          {searchQuery && (
            <p className="text-sm text-black mt-2">
              {filteredMedicines.length} {t('search.results_found')}
            </p>
          )}
          
          {/* Prescription Filter */}
          <div className="flex gap-2 mt-3">
            <button
              onClick={() => { setPrescriptionFilter('without'); setCurrentPage(1); }}
              className={`px-3 py-1.5 text-sm rounded-lg border transition-colors ${
                prescriptionFilter === 'without'
                  ? 'bg-green-600 text-white border-green-600'
                  : 'bg-white text-gray-700 border-gray-300 hover:border-gray-400'
              }`}
            >
              {t('filter.no_prescription')}
            </button>
            <button
              onClick={() => { setPrescriptionFilter('with'); setCurrentPage(1); }}
              className={`px-3 py-1.5 text-sm rounded-lg border transition-colors ${
                prescriptionFilter === 'with'
                  ? 'bg-red-600 text-white border-red-600'
                  : 'bg-white text-gray-700 border-gray-300 hover:border-gray-400'
              }`}
            >
              {t('filter.with_prescription')}
            </button>
            <button
              onClick={() => { setPrescriptionFilter('all'); setCurrentPage(1); }}
              className={`px-3 py-1.5 text-sm rounded-lg border transition-colors ${
                prescriptionFilter === 'all'
                  ? 'bg-gray-600 text-white border-gray-600'
                  : 'bg-white text-gray-700 border-gray-300 hover:border-gray-400'
              }`}
            >
              {t('filter.all')}
            </button>
          </div>
        </div>

        {/* Loading State */}
        {loading && (
          <div className="text-center py-12">
            <div className="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"></div>
            <p className="mt-4 text-black">{t('search.loading')}</p>
          </div>
        )}

        {/* Results */}
        {!loading && (
          <div className="grid gap-4 md:gap-6">
            {filteredMedicines.length === 0 ? (
              <div className="text-center py-12">
                <p className="text-xl text-gray-600">
                  {searchQuery ? t('search.no_results') : t('search.start_search')}
                </p>
              </div>
            ) : (
              paginatedMedicines.map((medicine) => (
                <div
                  key={medicine.id}
                  className="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow p-3 md:p-6 border border-gray-200"
                >
                  <div className="flex flex-col md:flex-row md:justify-between md:items-start gap-3 md:gap-4">
                    <div className="flex-1">
                      <h2 className="text-base md:text-xl font-bold text-black mb-1 md:mb-2">
                        {medicine.brandName}
                      </h2>
                      <div className="space-y-1 text-sm md:text-base">
                        {medicine.dosageForm && (
                          <p className="text-black text-sm md:text-base">
                            <span className="font-semibold">{t('medicine.dosage_form')}</span> {medicine.dosageForm}
                          </p>
                        )}
                        {medicine.activeIngredient && (
                          <p className="text-black hidden md:block">
                            <span className="font-semibold">{t('medicine.active_ingredient')}</span> {medicine.activeIngredient}
                          </p>
                        )}
                        <p className="text-black text-sm md:text-base hidden md:block">
                          <span className="font-semibold">{t('medicine.manufacturer')}</span> {medicine.manufacturer}
                        </p>
                        {medicine.packaging && (
                          <p className="text-gray-600 text-xs md:text-sm hidden md:block">
                            {medicine.packaging}
                          </p>
                        )}
                        {medicine.pharmacotherapyGroup && (
                          <p className="text-gray-600 text-sm hidden md:block">
                            <span className="font-semibold">{t('medicine.group')}</span> {medicine.pharmacotherapyGroup}
                          </p>
                        )}
                      </div>
                      
                      {/* Mobile: Prescription badge */}
                      <div className="mt-2 md:hidden">
                        <span
                          className={`inline-block px-2 py-1 rounded-full text-xs font-semibold ${
                            medicine.dispensingCondition === '–ü–æ —Ä–µ—Ü–µ–ø—Ç—É' || medicine.prescriptionRequired === true
                              ? 'bg-red-100 text-red-800 border border-red-300'
                              : 'bg-green-100 text-green-800 border border-green-300'
                          }`}
                        >
                          {medicine.dispensingCondition === '–ü–æ —Ä–µ—Ü–µ–ø—Ç—É' || medicine.prescriptionRequired === true 
                            ? t('medicine.prescription_required')
                            : t('medicine.no_prescription')}
                        </span>
                      </div>
                    </div>

                    {/* Desktop: Badge only */}
                    <div className="hidden md:flex flex-shrink-0">
                      <span
                        className={`inline-block px-3 py-1 rounded-full text-xs font-semibold whitespace-nowrap ${
                          medicine.dispensingCondition === '–ü–æ —Ä–µ—Ü–µ–ø—Ç—É' || medicine.prescriptionRequired === true
                            ? 'bg-red-100 text-red-800 border border-red-300'
                            : 'bg-green-100 text-green-800 border border-green-300'
                        }`}
                      >
                        {medicine.dispensingCondition === '–ü–æ —Ä–µ—Ü–µ–ø—Ç—É' || medicine.prescriptionRequired === true 
                          ? t('medicine.prescription_required')
                          : t('medicine.no_prescription')}
                      </span>
                    </div>
                  </div>
                </div>
              ))
            )}
          </div>
        )}

        {/* Pagination */}
        {!loading && filteredMedicines.length > 0 && totalPages > 1 && (
          <div className="flex justify-center items-center gap-2 mt-8">
            <button
              onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
              disabled={currentPage === 1}
              className="px-4 py-2 rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              ‚Üê
            </button>
            
            <div className="flex gap-1 items-center">
              {(() => {
                const pages = [];
                
                if (totalPages <= 7) {
                  // Show all pages if 7 or fewer
                  for (let i = 1; i <= totalPages; i++) {
                    pages.push(i);
                  }
                } else {
                  // Always show first page
                  pages.push(1);
                  
                  if (currentPage <= 3) {
                    // Near start: show 1, 2, 3, 4, ..., last
                    pages.push(2, 3, 4);
                    pages.push('ellipsis-end');
                    pages.push(totalPages);
                  } else if (currentPage >= totalPages - 2) {
                    // Near end: show 1, ..., last-3, last-2, last-1, last
                    pages.push('ellipsis-start');
                    pages.push(totalPages - 3, totalPages - 2, totalPages - 1, totalPages);
                  } else {
                    // Middle: show 1, ..., current-1, current, current+1, ..., last
                    pages.push('ellipsis-start');
                    pages.push(currentPage - 1, currentPage, currentPage + 1);
                    pages.push('ellipsis-end');
                    pages.push(totalPages);
                  }
                }
                
                return pages.map((page, idx) => {
                  if (typeof page === 'string') {
                    return (
                      <span key={page} className="px-2 text-gray-500">
                        ...
                      </span>
                    );
                  }
                  
                  return (
                    <button
                      key={page}
                      onClick={() => setCurrentPage(page)}
                      className={`px-3 py-2 rounded-lg border transition-colors ${
                        currentPage === page
                          ? 'bg-green-600 text-white border-green-600'
                          : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
                      }`}
                    >
                      {page}
                    </button>
                  );
                });
              })()}
            </div>

            <button
              onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
              disabled={currentPage === totalPages}
              className="px-4 py-2 rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              ‚Üí
            </button>
          </div>
        )}
      </main>

      {/* Footer */}
      <footer className="bg-white mt-12 py-6 border-t-2 border-green-200">
        <div className="container mx-auto px-4 text-center text-sm text-gray-600">
          <Link 
            href="/sources" 
            className="text-green-600 hover:text-green-700 font-semibold inline-block mb-3"
          >
            {t('footer.sources_link')}
          </Link>
          <p className="text-gray-500 text-xs">Mehr bilan, Ibrohim Iskandarov</p>
        </div>
      </footer>
    </div>
  );
}
*/
